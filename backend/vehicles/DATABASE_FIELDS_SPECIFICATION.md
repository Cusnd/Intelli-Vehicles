# 智能车辆维保记录管理系统 - 数据库字段规范说明

## 📊 概述

本文档详细说明系统数据库中每个表的字段定义、允许值、约束条件和用途说明。

---

## 1. 👤 用户表 (`user`)

| 字段名 | 数据类型 | 约束 | 允许值 | 说明 | 用途 |
|--------|----------|------|--------|------|------|
| `id` | BIGINT | 主键、自增、非空 | 1-9223372036854775807 | 用户唯一标识 | 系统内部标识用户 |
| `username` | VARCHAR(50) | 唯一、非空 | 3-50字符，字母数字下划线 | 用户登录名 | 用户登录认证 |
| `password` | VARCHAR(100) | 非空 | BCrypt加密后的密码 | 加密密码 | 用户身份验证 |
| `role` | ENUM | 非空、默认'user' | `'admin'` 或 `'user'` | 用户角色 | 权限控制 |
| `email` | VARCHAR(100) | 可空 | 标准邮箱格式 | 用户邮箱 | 联系方式、找回密码 |
| `phone` | VARCHAR(20) | 可空 | 11位手机号或固话 | 用户电话 | 联系方式 |
| `create_time` | DATETIME | 自动填充 | 系统当前时间 | 创建时间 | 审计追踪 |
| `update_time` | DATETIME | 自动更新 | 系统当前时间 | 更新时间 | 审计追踪 |

### 业务规则
- **用户名规则**: 3-50字符，只能包含字母、数字、下划线
- **密码规则**: 原始密码6-20位，存储时使用BCrypt加密
- **角色权限**:
  - `admin`: 管理员，可访问所有功能
  - `user`: 普通用户，只能管理自己的车辆和记录
- **邮箱格式**: 必须符合标准邮箱格式 (如: user@example.com)
- **电话格式**: 支持手机号(11位)或固话格式

---

## 2. 🚗 车辆表 (`vehicle`)

| 字段名 | 数据类型 | 约束 | 允许值 | 说明 | 用途 |
|--------|----------|------|--------|------|------|
| `id` | BIGINT | 主键、自增、非空 | 1-9223372036854775807 | 车辆唯一标识 | 系统内部标识车辆 |
| `license_plate` | VARCHAR(20) | 唯一、非空 | 中国车牌号格式 | 车牌号码 | 车辆识别 |
| `vin` | VARCHAR(50) | 唯一、非空 | 17位字符 | 车架号 | 车辆唯一识别码 |
| `brand` | VARCHAR(50) | 可空 | 汽车品牌名称 | 汽车品牌 | 车辆基本信息 |
| `model` | VARCHAR(50) | 可空 | 汽车型号 | 汽车型号 | 车辆详细信息 |
| `owner_name` | VARCHAR(50) | 可空 | 车主姓名 | 车主姓名 | 联系信息 |
| `owner_phone` | VARCHAR(20) | 可空 | 11位手机号 | 车主电话 | 联系方式 |
| `user_id` | BIGINT | 外键、可空 | 用户表ID | 关联用户 | 数据权限控制 |
| `create_time` | DATETIME | 自动填充 | 系统当前时间 | 创建时间 | 审计追踪 |
| `update_time` | DATETIME | 自动更新 | 系统当前时间 | 更新时间 | 审计追踪 |

### 业务规则
- **车牌号格式**: 
  - 普通车牌: 京A12345、沪B67890
  - 新能源: 京AD12345（绿牌）
  - 长度: 7-8位字符
- **VIN码规则**: 17位字符，包含字母和数字（不含I、O、Q）
- **品牌示例**: 本田、丰田、大众、奔驰、宝马、奥迪等
- **型号示例**: 雅阁、凯美瑞、速腾、C级、3系、A4L等
- **车主姓名**: 2-50字符中文或英文
- **外键约束**: 删除用户时，车辆的user_id设置为NULL

---

## 3. 🔧 维保记录表 (`maintenance_record`)

| 字段名 | 数据类型 | 约束 | 允许值 | 说明 | 用途 |
|--------|----------|------|--------|------|------|
| `id` | BIGINT | 主键、自增、非空 | 1-9223372036854775807 | 记录唯一标识 | 维保记录标识 |
| `vehicle_id` | BIGINT | 外键、非空 | 车辆表有效ID | 关联车辆 | 标识维保的车辆 |
| `service_date` | DATE | 非空 | 有效日期格式 | 维保日期 | 维保执行日期 |
| `cost` | DECIMAL(10,2) | 默认0.00 | 0.00-99999999.99 | 维保总费用 | 财务统计 |
| `service_person` | VARCHAR(50) | 可空 | 服务人员姓名 | 维保人员 | 服务跟踪 |
| `remarks` | TEXT | 可空 | 维保备注信息 | 维保备注 | 详细描述 |
| `create_time` | DATETIME | 自动填充 | 系统当前时间 | 创建时间 | 审计追踪 |
| `update_time` | DATETIME | 自动更新 | 系统当前时间 | 更新时间 | 审计追踪 |

### 业务规则
- **服务日期**: 不能晚于当前日期，通常在最近5年内
- **费用范围**: 0-99,999,999.99元，精确到分
- **费用计算**: 自动汇总关联维保项目的费用
- **服务人员**: 维修技师或服务顾问姓名
- **备注用途**: 记录故障描述、维保过程、注意事项等
- **外键约束**: 删除车辆时，相关维保记录被级联删除

---

## 4. 🛠️ 维保项目表 (`maintenance_item`)

| 字段名 | 数据类型 | 约束 | 允许值 | 说明 | 用途 |
|--------|----------|------|--------|------|------|
| `id` | BIGINT | 主键、自增、非空 | 1-9223372036854775807 | 项目唯一标识 | 维保项目标识 |
| `record_id` | BIGINT | 外键、非空 | 维保记录表有效ID | 关联记录 | 标识所属维保记录 |
| `item_name` | VARCHAR(100) | 非空 | 维保项目名称 | 项目名称 | 标识具体维保内容 |
| `item_cost` | DECIMAL(10,2) | 可空 | 0.00-99999999.99 | 项目费用 | 单项费用统计 |

### 业务规则
- **项目名称示例**:
  - 常规保养: 更换机油、更换机滤、更换空滤、更换汽滤
  - 检查项目: 轮胎检查、刹车检查、电池检查、灯光检查
  - 维修项目: 更换刹车片、更换火花塞、更换皮带、修复漆面
  - 其他服务: 四轮定位、轮胎平衡、空调清洗、内饰清洁
- **费用范围**: 单项0-99,999,999.99元
- **项目分类**: 建议按照保养、维修、检查、清洁等分类
- **外键约束**: 删除维保记录时，相关项目被级联删除

---

## 5. 📋 操作日志表 (`log`)

| 字段名 | 数据类型 | 约束 | 允许值 | 说明 | 用途 |
|--------|----------|------|--------|------|------|
| `id` | BIGINT | 主键、自增、非空 | 1-9223372036854775807 | 日志唯一标识 | 日志记录标识 |
| `user_id` | BIGINT | 外键、可空 | 用户表有效ID | 操作用户 | 标识操作执行者 |
| `operation` | VARCHAR(100) | 可空 | 操作类型描述 | 操作类型 | 记录用户行为 |
| `ip_address` | VARCHAR(45) | 可空 | IP地址格式 | 客户端IP | 安全审计 |
| `create_time` | DATETIME | 自动填充 | 系统当前时间 | 操作时间 | 操作时间记录 |

### 业务规则
- **操作类型示例**:
  - 用户操作: 登录系统、注册账号、修改密码、更新资料
  - 车辆操作: 添加车辆、更新车辆、删除车辆、查询车辆
  - 维保操作: 添加维保记录、更新维保记录、删除维保记录
  - 系统操作: 导出报表、数据备份、系统维护
- **IP地址格式**: 
  - IPv4: 192.168.1.100
  - IPv6: 2001:0db8:85a3:0000:0000:8a2e:0370:7334
- **数据保留**: 建议保留最近90天的日志，定期清理
- **外键约束**: 删除用户时，日志的user_id设置为NULL

---

## 📝 数据约束总结

### 字符长度限制
- 短文本(20字符): 车牌号、电话号码
- 中文本(50字符): 用户名、姓名、品牌型号
- 长文本(100字符): 邮箱、操作类型、项目名称
- 超长文本(TEXT): 维保备注

### 数值精度
- 整数: BIGINT (最大19位数字)
- 金额: DECIMAL(10,2) (最大8位整数+2位小数)

### 时间格式
- 日期: DATE (YYYY-MM-DD)
- 时间戳: DATETIME (YYYY-MM-DD HH:MM:SS)

### 唯一性约束
- 用户名、车牌号、VIN码必须唯一
- 避免重复数据，确保数据一致性

### 外键关系
```
user (1) ——— (n) vehicle
vehicle (1) ——— (n) maintenance_record  
maintenance_record (1) ——— (n) maintenance_item
user (1) ——— (n) log
```

### 级联操作
- 删除用户: vehicle.user_id 和 log.user_id 设为NULL
- 删除车辆: 级联删除所有维保记录和项目
- 删除维保记录: 级联删除所有相关项目

---

## 🔒 数据安全考虑

1. **密码加密**: 使用BCrypt算法加密存储
2. **敏感信息**: 电话、邮箱等个人信息需要保护
3. **数据备份**: 重要数据定期备份
4. **访问控制**: 基于用户角色的数据访问权限
5. **操作审计**: 所有重要操作记录到日志表

---

**文档版本**: v1.0  
**更新日期**: 2024年1月  
**维护人员**: 系统开发团队 